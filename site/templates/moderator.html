<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>RedditNobility</title>
    <meta property="og:image" content="https://redditnobility.org/assets/img/TuxCrown.png">
    <meta property="og:type" content="website">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta3/css/bootstrap.min.css">
    <link rel="stylesheet" href='{{url(path="css/Login-Form-Clean.css")}}'>
    <link rel="stylesheet" href='{{url(path="css/styles.css")}}'>
    <link rel="stylesheet" href='{{url(path="css/Team-Clean.css")}}'>
    <link rel="stylesheet" href='{{url(path="css/Team-Grid.css")}}'>
    <link rel="preconnect" href="https://fonts.gstatic.com">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
<nav class="navbar navbar-light navbar-expand-md">
    <div class="container-fluid"><a class="navbar-brand" href="#">RedditNobility</a>
        <button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-1"><span
                class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navcol-1">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link active" href="{{url(path='moderator/review/next')}}">Review
                    Users</a></li>
                <li class="nav-item"><a class="nav-link active" onclick="reviewUser()" href="#">Review a User</a></li>
                <li class="nav-item"><a class="nav-link active" onclick="userPage()">User Page</a></li>
                <li class="nav-item"></li>
                <li class="nav-item"><a class="nav-link disabled" href="#">Check Reddit</a></li>
            </ul>
        </div>
    </div>
</nav><!-- Start: 1 Row 2 Columns -->
<div class="container">
    <div class="row">
        <div class="col-md-6">
            <div class="table-responsive" style="width: 658px;">
                <table class="table">
                    <thead>
                    <tr>
                        <th>Community</th>
                        <th>User Count</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>Discord</td>
                        <td>COMING SOON</td>
                    </tr>
                    <tr>
                        <td>SubReddit</td>
                        <td>COMING SOON</td>
                    </tr>
                    <tr>
                        <td>Awaiting Approval</td>
                        <td>COMING SOON</td>
                    </tr>
                    <tr></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-md-6">
            <h5>User Auto Check - If enabled site will look for users every 2 hours.</h5>
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown"
                        type="button">Auto Check: Active
                </button>
                <div class="dropdown-menu"><a class="dropdown-item" href="#">Active</a><a class="dropdown-item"
                                                                                          href="#">Disable</a></div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <h5>Upload User List</h5>
            <progress id="progressBar" value="0" max="100" style="width:300px;"></progress>
            <h3 id="status"></h3>
            <p id="loaded_n_total"></p>
            <input id="usersfile" name="file" type="file">
            <button class="btn btn-primary" onclick="uploadFile()" type="button">Upload</button>
        </div>
        <div class="col"></div>
    </div>
</div><!-- End: 1 Row 2 Columns -->
<!-- Start: Search Reddit -->
<div class="modal fade" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Check Reddit</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form><label class="form-label">Subreddit</label><input class="form-control" type="text"
                                                                        placeholder="r/Subreddit" value="r/all"><label
                        class="form-label">Number of posts</label><input class="form-control" type="number" max="100"
                                                                         min="1" value="50"><label class="form-label">Number
                    of Comments per post</label><input class="form-control" type="number" max="100" min="1" value="100">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" type="button" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" type="button">Search</button>
            </div>
        </div>
    </div>
</div><!-- End: Search Reddit -->
<div class="modal fade" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Result</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-success" role="alert"><span><strong>Search has started</strong></span></div>
                <div class="alert alert-success" role="alert"><span><strong>Search is currently happening or happened within the past 10 minutes</strong></span>
                </div>
                <div class="alert alert-success" role="alert">
                    <span><strong>User is not found on</strong>&nbsp;Reddit<br></span></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" type="button" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div><!-- Start: User Page -->
<div class="modal fade" id="user" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">User Page</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-success" role="alert"><span><strong>If user is not already in database the user will be added.</strong></span>
                </div>
                <h4>Username</h4>
                <input id="username" type="text" placeholder="Username">
            </div>
            <div class="modal-footer">
                <button class="btn btn-light" type="button" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" onclick="openUser()" type="button">Open User</button>
            </div>
        </div>
    </div>
</div><!-- End: User Page -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta3/js/bootstrap.bundle.min.js"></script>
<script src='{{url(path="cdn/jquery/dist/jquery.js")}}'></script>

<script>
    const review_url = "{{url(path='moderator/review/')|safe}}";
    const user_url = "{{url(path='moderator/user/')|safe}}";
    const upload_users = "{{url(path='moderator/file/upload')|safe}}";
    const auth_token = getCookie("auth_token");

    let review = false;

    function uploadFile() {
        let value = document.getElementById("usersfile");

        const formData = new FormData();
        let file = value.files[0];
        console.log(file)
        formData.append('file', file)
        var ajax = new XMLHttpRequest();
        ajax.upload.addEventListener("progress", progressHandler, false);
        ajax.addEventListener("load", completeHandler, false);
        ajax.addEventListener("error", errorHandler, false);
        ajax.addEventListener("abort", abortHandler, false);
        ajax.open("POST", upload_users); // http://www.developphp.com/video/JavaScript/File-Upload-Progress-Bar-Meter-Tutorial-Ajax-PHP
        //use file_upload_parser.php from above url
        ajax.setRequestHeader("Authorization", "Bearer " + auth_token)

        ajax.send(formData);
    }

    function _(el) {
        return document.getElementById(el);
    }

    function progressHandler(event) {
        _("loaded_n_total").innerHTML = "Uploaded " + event.loaded + " bytes of " + event.total;
        var percent = (event.loaded / event.total) * 100;
        _("progressBar").value = Math.round(percent);
        _("status").innerHTML = Math.round(percent) + "% uploaded... please wait";
    }

    function completeHandler(event) {
        _("status").innerHTML = event.target.responseText;
        _("progressBar").value = 0; //wil clear progress bar after successful upload
        let json = JSON.parse(event.target.responseText);
        if (json.success) {
            alert(json.data + " users added");
        } else {
            alert("Upload Failed")
        }
    }

    function errorHandler(event) {
        _("status").innerHTML = "Upload Failed";
    }

    function abortHandler(event) {
        _("status").innerHTML = "Upload Aborted";
    }

    function reviewUser() {
        review = true;
        $('#user').modal('show')
    }

    function userPage() {
        review = false;
        $('#user').modal('show')
    }

    function openUser() {
        let value = document.getElementById("username").value;
        if (typeof value !== 'undefined') {
            if (review) {
                window.location.href = review_url + value;
            } else {
                window.location.href = user_url + value + "?add_if_not_found=true";
            }
        }
    }

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
</script>
</body>

</html>